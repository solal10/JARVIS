"use strict";(()=>{var e={};e.id=834,e.ids=[834],e.modules={517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},2081:e=>{e.exports=require("child_process")},2361:e=>{e.exports=require("events")},7147:e=>{e.exports=require("fs")},6005:e=>{e.exports=require("node:crypto")},1017:e=>{e.exports=require("path")},2781:e=>{e.exports=require("stream")},7310:e=>{e.exports=require("url")},5493:(e,t,r)=>{r.r(t),r.d(t,{headerHooks:()=>k,originalPathname:()=>S,patchFetch:()=>E,requestAsyncStorage:()=>w,routeModule:()=>y,serverHooks:()=>v,staticGenerationAsyncStorage:()=>M,staticGenerationBailout:()=>b});var s={};r.r(s),r.d(s,{GET:()=>g,POST:()=>x});var i=r(884),n=r(6132),o=r(1040),a=r(5798),c=r(8424);class u{constructor(){this.isRunning=!1,this.jobs=new Map}static getInstance(){return u.instance||(u.instance=new u),u.instance}start(){if(this.isRunning)return;let e=c.Os("0 9 */2 * *",async()=>{try{let e=await fetch(`${process.env.NEXT_PUBLIC_APP_URL||"http://localhost:3000"}/api/auto-generate-blog`,{method:"POST"}),t=await e.json();t.success}catch(e){}},{timezone:"Europe/Paris"}),t=c.Os("0 8 * * *",async()=>{try{let e=await fetch(`${process.env.NEXT_PUBLIC_APP_URL||"http://localhost:3000"}/api/trends`),t=await e.json();if(t.success&&t.articleIdeas.length>0){let e=t.articleIdeas.filter(e=>e.priority>50);if(e.length>0){let e=await fetch(`${process.env.NEXT_PUBLIC_APP_URL||"http://localhost:3000"}/api/auto-generate-blog`,{method:"POST"}),t=await e.json();t.success}}}catch(e){}},{timezone:"Europe/Paris"}),r=c.Os("0 0 * * 0",async()=>{},{timezone:"Europe/Paris"});this.jobs.set("main",e),this.jobs.set("trends",t),this.jobs.set("maintenance",r),e.start(),t.start(),r.start(),this.isRunning=!0}stop(){this.isRunning&&(this.jobs.forEach((e,t)=>{e.stop(),e.destroy()}),this.jobs.clear(),this.isRunning=!1)}async generateNow(){try{let e=await fetch(`${process.env.NEXT_PUBLIC_APP_URL||"http://localhost:3000"}/api/auto-generate-blog`,{method:"POST"}),t=await e.json();return t.success,t}catch(e){return{success:!1,error:"Erreur lors de la g\xe9n\xe9ration manuelle"}}}getStatus(){return{isRunning:this.isRunning,activeJobs:Array.from(this.jobs.keys()),nextRuns:this.isRunning?{articles:"Tous les 2 jours \xe0 9h00",trends:"Tous les jours \xe0 8h00",maintenance:"Dimanche \xe0 minuit"}:null}}scheduleOneTime(e,t="T\xe2che unique"){let r=`onetime_${Date.now()}`,s=c.Os(e,async()=>{await this.generateNow(),s.stop(),s.destroy(),this.jobs.delete(r)},{timezone:"Europe/Paris"});return this.jobs.set(r,s),r}}let h=u.getInstance(),l=()=>h.start(),d=()=>h.stop(),f=()=>h.generateNow(),m=()=>h.getStatus();var p=r(4051);async function g(){try{let e=m(),t=(0,p.N_)(),r=(0,p.Nh)();return a.Z.json({success:!0,scheduler:e,articles:{total:t.length,recent:t.slice(0,5).map(e=>({title:e.title,slug:e.slug,category:e.category,publishedAt:e.publishedAt,views:e.views||0}))},stats:r})}catch(e){return a.Z.json({success:!1,error:"Erreur lors de la r\xe9cup\xe9ration du statut"},{status:500})}}async function x(e){try{let{action:t}=await e.json();switch(t){case"start":return l(),a.Z.json({success:!0,message:"Automatisation du blog d\xe9marr\xe9e",status:m()});case"stop":return d(),a.Z.json({success:!0,message:"Automatisation du blog arr\xeat\xe9e",status:m()});case"generate":let r=await f();return a.Z.json({success:r.success,message:r.success?"Article g\xe9n\xe9r\xe9 avec succ\xe8s":"Erreur lors de la g\xe9n\xe9ration",result:r});default:return a.Z.json({success:!1,error:"Action non reconnue. Actions disponibles: start, stop, generate"},{status:400})}}catch(e){return a.Z.json({success:!1,error:"Erreur lors de l'ex\xe9cution de l'action"},{status:500})}}let y=new i.AppRouteRouteModule({definition:{kind:n.x.APP_ROUTE,page:"/api/blog-control/route",pathname:"/api/blog-control",filename:"route",bundlePath:"app/api/blog-control/route"},resolvedPagePath:"/Users/JARVIS/Desktop/JARVIS/frontend/src/app/api/blog-control/route.ts",nextConfigOutput:"",userland:s}),{requestAsyncStorage:w,staticGenerationAsyncStorage:M,serverHooks:v,headerHooks:k,staticGenerationBailout:b}=y,S="/api/blog-control/route";function E(){return(0,o.patchFetch)({serverHooks:v,staticGenerationAsyncStorage:M})}},4051:(e,t,r)=>{r.d(t,{N_:()=>f,Nh:()=>y,Ov:()=>w,Wg:()=>m,j8:()=>l,v:()=>g,vA:()=>p,y8:()=>d});var s=r(7147),i=r.n(s),n=r(1017),o=r.n(n);let a=o().join(process.cwd(),"src","data","blog"),c=o().join(a,"articles.json"),u=o().join(a,"stats.json");function h(){i().existsSync(a)||i().mkdirSync(a,{recursive:!0}),i().existsSync(c)||i().writeFileSync(c,JSON.stringify([],null,2)),i().existsSync(u)||i().writeFileSync(u,JSON.stringify({totalArticles:0,publishedArticles:0,totalViews:0,lastGenerated:null,categoriesStats:{},topKeywords:[]},null,2))}function l(e){try{h();let t=d(),r=t.findIndex(t=>t.slug===e.slug);return r>=0?t[r]={...e,lastModified:new Date().toISOString()}:t.push(e),i().writeFileSync(c,JSON.stringify(t,null,2)),x(),!0}catch(e){return!1}}function d(){try{if(h(),!i().existsSync(c))return[];let e=i().readFileSync(c,"utf-8");return JSON.parse(e)}catch(e){return[]}}function f(){let e=d();return e.filter(e=>"published"===e.status)}function m(e){let t=d();return t.find(t=>t.slug===e)||null}function p(e=10){let t=f();return t.sort((e,t)=>new Date(t.publishedAt).getTime()-new Date(e.publishedAt).getTime()).slice(0,e)}function g(e){try{let t=d(),r=t.findIndex(t=>t.slug===e);r>=0&&(t[r].views=(t[r].views||0)+1,i().writeFileSync(c,JSON.stringify(t,null,2)),x())}catch(e){}}function x(){try{let e=d(),t=e.filter(e=>"published"===e.status),r={};t.forEach(e=>{r[e.category]=(r[e.category]||0)+1});let s={};t.forEach(e=>{e.keywords.forEach(e=>{s[e]=(s[e]||0)+1})});let n=Object.entries(s).sort(([,e],[,t])=>t-e).slice(0,20).map(([e,t])=>({keyword:e,count:t})),o=e.reduce((e,t)=>e+(t.views||0),0),a={totalArticles:e.length,publishedArticles:t.length,totalViews:o,lastGenerated:new Date().toISOString(),categoriesStats:r,topKeywords:n};i().writeFileSync(u,JSON.stringify(a,null,2))}catch(e){}}function y(){try{if(h(),!i().existsSync(u))return{totalArticles:0,publishedArticles:0,totalViews:0,lastGenerated:null,categoriesStats:{},topKeywords:[]};let e=i().readFileSync(u,"utf-8");return JSON.parse(e)}catch(e){return null}}function w(e){let t=d(),r=e.toLowerCase().replace(/[àáâäæãåāăą]/g,"a").replace(/[çćčĉċ]/g,"c").replace(/[èéêëēėęěĕ]/g,"e").replace(/[ìíîïīįìĩĭ]/g,"i").replace(/[òóôöőõøōŏ]/g,"o").replace(/[ùúûüūůűũŭ]/g,"u").replace(/[ñń]/g,"n").replace(/[ß]/g,"ss").replace(/[^a-z0-9]+/g,"-").replace(/^-+|-+$/g,"").substring(0,50),s=1,i=r;for(;t.some(e=>e.slug===i);)i=`${r}-${s}`,s++;return i}},280:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.createID=function(e="",t=16){let r="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",i=s.default.randomBytes(t),n=Array.from(i,e=>r[e%r.length]).join("");return e?`${e}-${n}`:n};let s=function(e){return e&&e.__esModule?e:{default:e}}(r(6005))},1602:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0});let r={INFO:"\x1b[36m",WARN:"\x1b[33m",ERROR:"\x1b[31m",DEBUG:"\x1b[35m"};function s(e,t,s){new Date().toISOString(),r[e],process.pid}t.default={info(e){s("INFO",e)},warn(e){s("WARN",e)},error(e,t){e instanceof Error?s("ERROR",e.message,e):s("ERROR",e,t)},debug(e,t){e instanceof Error?s("DEBUG",e.message,e):s("DEBUG",e,t)}}},8424:(e,t,r)=>{var s=function(e){return e&&e.__esModule?e:{default:e}};t.yb=t._X=t.Ak=void 0,t.Os=l;let i=r(5426),n=r(1516),o=s(r(8119)),a=s(r(6488)),c=s(r(1017)),u=r(7310),h=new n.TaskRegistry;function l(e,t,r){let s=d(e,t,r);return s.start(),s}function d(e,t,r){let s;if(t instanceof Function)s=new i.InlineScheduledTask(e,t,r);else{let i=function(e){if(c.default.isAbsolute(e))return(0,u.pathToFileURL)(e).href;if(e.startsWith("file://"))return e;let t=Error().stack?.split("\n");if(t){t?.shift();let r=t?.find(e=>e.indexOf(__filename)===-1),s=r?.match(/(file:\/\/)?(((\/?)(\w:))?([/\\].+)):\d+:\d+/);if(s){let t=`${s[5]??""}${c.default.dirname(s[6])}`;return(0,u.pathToFileURL)(c.default.resolve(t,e)).href}}throw Error(`Could not locate task file ${e}`)}(t);s=new a.default(e,i,r)}return h.add(s),s}t.Ak=h.all,t._X=h.get,t.yb={schedule:l,createTask:d,validate:function(e){try{return(0,o.default)(e),!0}catch(e){return!1}},getTasks:t.Ak,getTask:t._X},t.yb},7238:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.default=(()=>{function e(e,t){return -1!==e.indexOf("*")?e.replace("*",t):e}return function(t){return t[0]=e(t[0],"0-59"),t[1]=e(t[1],"0-59"),t[2]=e(t[2],"0-23"),t[3]=e(t[3],"1-31"),t[4]=e(t[4],"1-12"),t[5]=e(t[5],"0-6"),t}})()},4117:(e,t,r)=>{var s=function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});let i=s(r(9795)),n=s(r(6256)),o=s(r(7238)),a=s(r(6587));t.default=function(e){var t;let r=`${e}`.replace(/\s{2,}/g," ").trim().split(" ");return(r=5===(t=r).length?["0"].concat(t):t)[4]=(0,i.default)(r[4]),r[5]=(0,n.default)(r[5]),r=(0,o.default)(r),r=function(e){for(let t=0;t<e.length;t++){let r=e[t].split(",");for(let e=0;e<r.length;e++)r[e]=parseInt(r[e]);e[t]=r}return e}(r=(0,a.default)(r))}},9795:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.default=(()=>{let e=["january","february","march","april","may","june","july","august","september","october","november","december"],t=["jan","feb","mar","apr","may","jun","jul","aug","sep","oct","nov","dec"];function r(e,t){for(let r=0;r<t.length;r++)e=e.replace(RegExp(t[r],"gi"),r+1);return e}return function(s){return s=r(s,e),s=r(s,t)}})()},6587:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){for(let t=0;t<e.length;t++)e[t]=function(e){let t=/(\d+)-(\d+)(\/(\d+)|)/,r=t.exec(e);for(;null!==r&&r.length>0;)r=t.exec(e=function(e,t,r,s,i){let n=parseInt(i),o=[],a=parseInt(s),c=parseInt(r);c>a&&(a=parseInt(r),c=parseInt(s));for(let e=c;e<=a;e+=n)o.push(e);return e.replace(RegExp(t,"i"),o.join())}(e,r[0],r[1],r[2],r[4]||"1"));return e}(e[t]);return e}},6256:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.default=(()=>{let e=["sunday","monday","tuesday","wednesday","thursday","friday","saturday"],t=["sun","mon","tue","wed","thu","fri","sat"];function r(e,t){for(let r=0;r<t.length;r++)e=e.replace(RegExp(t[r],"gi"),r);return e}return function(s){return s=r(s=s.replace("7","0"),e),r(s,t)}})()},8119:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0});let s=function(e){return e&&e.__esModule?e:{default:e}}(r(4117)),i=/^(?:\d+|\*|\*\/\d+)$/;function n(e,t,r){for(let s of e){let e=parseInt(s,10);if(!Number.isNaN(e)&&(e<t||e>r)||!i.test(s))return!1}return!0}t.default=function(e){if("string"!=typeof e)throw TypeError("pattern must be a string!");let t=e.split(" "),r=(0,s.default)(e);5===t.length&&t.unshift("0"),function(e,t){if(!n(t[0],0,59))throw Error(`${e[0]} is a invalid expression for second`);if(!n(t[1],0,59))throw Error(`${e[1]} is a invalid expression for minute`);if(!n(t[2],0,23))throw Error(`${e[2]} is a invalid expression for hour`);if(!n(t[3],1,31))throw Error(`${e[3]} is a invalid expression for day of month`);if(!n(t[4],1,12))throw Error(`${e[4]} is a invalid expression for month`);if(!n(t[5],0,7))throw Error(`${e[5]} is a invalid expression for week day`)}(t,r)}},1591:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.TrackedPromise=void 0;class r{constructor(e){this.state="pending",this.promise=new Promise((t,r)=>{e(e=>{this.state="fulfilled",this.value=e,t(e)},e=>{this.state="rejected",this.error=e,r(e)})})}getPromise(){return this.promise}getState(){return this.state}isPending(){return"pending"===this.state}isFulfilled(){return"fulfilled"===this.state}isRejected(){return"rejected"===this.state}getValue(){return this.value}getError(){return this.error}then(e,t){return this.promise.then(e,t)}catch(e){return this.promise.catch(e)}finally(e){return this.promise.finally(e)}}t.TrackedPromise=r},9262:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.Runner=void 0;let s=r(280),i=function(e){return e&&e.__esModule?e:{default:e}}(r(1602)),n=r(1591);function o(){}function a(){return!0}function c(e,t){i.default.error("Task failed with error!",t)}class u{constructor(e,t,r){this.timeMatcher=e,this.onMatch=t,this.noOverlap=void 0!=r&&void 0!==r.noOverlap&&r.noOverlap,this.maxExecutions=r?.maxExecutions,this.maxRandomDelay=r?.maxRandomDelay||0,this.onMissedExecution=r?.onMissedExecution||o,this.onOverlap=r?.onOverlap||o,this.onError=r?.onError||c,this.onFinished=r?.onFinished||a,this.beforeRun=r?.beforeRun||a,this.onMaxExecutions=r?.onMaxExecutions||o,this.runCount=0,this.running=!1}start(){let e,t;this.running=!0;let r=e=>{this.running&&(clearTimeout(this.heartBeatTimeout),this.heartBeatTimeout=setTimeout(u,l(this.timeMatcher,e)))},o=e=>new Promise(async t=>{let r={id:(0,s.createID)("exec"),reason:"scheduled"},i=await this.beforeRun(e,r),n=Math.floor(Math.random()*this.maxRandomDelay);i&&setTimeout(async()=>{try{this.runCount++,r.startedAt=new Date;let t=await this.onMatch(e,r);r.finishedAt=new Date,r.result=t,this.onFinished(e,r),this.maxExecutions&&this.runCount>=this.maxExecutions&&(this.onMaxExecutions(e),this.stop())}catch(t){r.finishedAt=new Date,r.error=t,this.onError(e,t,r)}t(!0)},n)}),a=e=>new n.TrackedPromise(async(t,r)=>{try{this.timeMatcher.match(e)&&await o(e),t(!0)}catch(e){r(e)}}),u=async()=>{let s=d();if(t&&t.getTime()<s.getTime())for(;t.getTime()<s.getTime();)i.default.warn(`missed execution at ${t}! Possible blocking IO or high CPU user at the same process used by node-cron.`),t=this.timeMatcher.getNextMatch(t),h(this.onMissedExecution,t,c);if(e&&"pending"===e.getState()&&(h(this.onOverlap,s,c),this.noOverlap)){i.default.warn("task still running, new execution blocked by overlap prevention!"),t=this.timeMatcher.getNextMatch(s),r(s);return}e=a(s),t=this.timeMatcher.getNextMatch(s),r(s)};this.heartBeatTimeout=setTimeout(()=>{u()},l(this.timeMatcher,d()))}nextRun(){return this.timeMatcher.getNextMatch(new Date)}stop(){this.running=!1,this.heartBeatTimeout&&(clearTimeout(this.heartBeatTimeout),this.heartBeatTimeout=void 0)}isStarted(){return!!this.heartBeatTimeout&&this.running}isStopped(){return!this.isStarted()}async execute(){let e=new Date,t={id:(0,s.createID)("exec"),reason:"invoked"};try{let r=await this.beforeRun(e,t);if(r){this.runCount++,t.startedAt=new Date;let r=await this.onMatch(e,t);t.finishedAt=new Date,t.result=r,this.onFinished(e,t)}}catch(r){t.finishedAt=new Date,t.error=r,this.onError(e,r,t)}}}async function h(e,t,r){try{await e(t)}catch(e){r(t,e)}}function l(e,t){let r=e.getNextMatch(t),s=new Date,i=r.getTime()-s.getTime();return i>864e5?864e5:Math.max(0,i)}function d(){let e=new Date;return e.setMilliseconds(0),e}t.Runner=u},1516:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.TaskRegistry=void 0;let r=new Map;class s{add(e){if(this.has(e.id))throw Error(`task ${e.id} already registred!`);r.set(e.id,e),e.on("task:destroyed",()=>{this.remove(e)})}get(e){return r.get(e)}remove(e){this.has(e.id)&&(e?.destroy(),r.delete(e.id))}all(){return r}has(e){return r.has(e)}killAll(){r.forEach(e=>this.remove(e))}}t.TaskRegistry=s},6488:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0});let s=r(1017),i=r(2081),n=r(280),o=r(2781),a=r(958),c=r(8279),u=function(e){return e&&e.__esModule?e:{default:e}}(r(1602)),h=r(4629),l=(0,s.resolve)(__dirname,"daemon.js");class d extends o.EventEmitter{}class f{constructor(e,t,r){this.cronExpression=e,this.taskPath=t,this.options=r,this.id=(0,n.createID)("task"),this.name=r?.name||this.id,this.emitter=new d,this.stateMachine=new a.StateMachine("stopped"),this.on("task:stopped",()=>{this.forkProcess?.kill(),this.forkProcess=void 0,this.stateMachine.changeState("stopped")}),this.on("task:destroyed",()=>{this.forkProcess?.kill(),this.forkProcess=void 0,this.stateMachine.changeState("destroyed")})}getNextRun(){if("stopped"!==this.stateMachine.state){let e=new h.TimeMatcher(this.cronExpression,this.options?.timezone);return e.getNextMatch(new Date)}return null}start(){return new Promise((e,t)=>{if(this.forkProcess)return e(void 0);let r=setTimeout(()=>{t(Error("Start operation timed out"))},5e3);try{this.forkProcess=(0,i.fork)(l),this.forkProcess.on("error",e=>{clearTimeout(r),t(Error(`Error on daemon: ${e.message}`))}),this.forkProcess.on("exit",(e,s)=>{if(0!==e&&"SIGTERM"!==s){let i=Error(`node-cron daemon exited with code ${e||s}`);u.default.error(i),clearTimeout(r),t(i)}}),this.forkProcess.on("message",e=>{if(e.jsonError&&e.context?.execution&&(e.context.execution.error=function(e){let t=JSON.parse(e),r=globalThis[t.name]||Error,s=new r(t.message);return t.stack&&(s.stack=t.stack),Object.keys(t).forEach(e=>{["name","message","stack"].includes(e)||(s[e]=t[e])}),s}(e.jsonError),delete e.jsonError),e.context?.task?.state&&this.stateMachine.changeState(e.context?.task?.state),e.context){let t=e.context?.execution;delete t?.hasError;let r=this.createContext(new Date(e.context.date),t);this.emitter.emit(e.event,r)}}),this.once("task:started",()=>{this.stateMachine.changeState("idle"),clearTimeout(r),e(void 0)}),this.forkProcess.send({command:"task:start",path:this.taskPath,cron:this.cronExpression,options:this.options})}catch(e){t(e)}})}stop(){return new Promise((e,t)=>{if(!this.forkProcess)return e(void 0);let r=setTimeout(()=>{clearTimeout(r),t(Error("Stop operation timed out"))},5e3),s=()=>{clearTimeout(r),this.off("task:stopped",i),this.forkProcess=void 0,e(void 0)},i=()=>{s()};this.once("task:stopped",i),this.forkProcess.send({command:"task:stop"})})}getStatus(){return this.stateMachine.state}destroy(){return new Promise((e,t)=>{if(!this.forkProcess)return e(void 0);let r=setTimeout(()=>{clearTimeout(r),t(Error("Destroy operation timed out"))},5e3),s=()=>{clearTimeout(r),this.off("task:destroyed",s),e(void 0)};this.once("task:destroyed",s),this.forkProcess.send({command:"task:destroy"})})}execute(){return new Promise((e,t)=>{if(!this.forkProcess)return t(Error("Cannot execute background task because it hasn't been started yet. Please initialize the task using the start() method before attempting to execute it."));let r=setTimeout(()=>{s(),t(Error("Execution timeout exceeded"))},5e3),s=()=>{clearTimeout(r),this.off("execution:finished",i),this.off("execution:failed",n)},i=t=>{s(),e(t.execution?.result)},n=e=>{s(),t(e.execution?.error||Error("Execution failed without specific error"))};this.once("execution:finished",i),this.once("execution:failed",n),this.forkProcess.send({command:"task:execute"})})}on(e,t){this.emitter.on(e,t)}off(e,t){this.emitter.off(e,t)}once(e,t){this.emitter.once(e,t)}createContext(e,t){let r=new c.LocalizedTime(e,this.options?.timezone),s={date:r.toDate(),dateLocalIso:r.toISO(),triggeredAt:new Date,task:this,execution:t};return s}}t.default=f},5426:(e,t,r)=>{var s=function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.InlineScheduledTask=void 0;let i=s(r(2361)),n=r(9262),o=r(4629),a=r(280),c=r(958),u=s(r(1602)),h=r(8279);class l extends i.default{}class d{constructor(e,t,r){this.emitter=new l,this.cronExpression=e,this.id=(0,a.createID)("task",12),this.name=r?.name||this.id,this.timezone=r?.timezone,this.timeMatcher=new o.TimeMatcher(e,r?.timezone),this.stateMachine=new c.StateMachine;let s={timezone:r?.timezone,noOverlap:r?.noOverlap,maxExecutions:r?.maxExecutions,maxRandomDelay:r?.maxRandomDelay,beforeRun:(e,t)=>("scheduled"===t.reason&&this.changeState("running"),this.emitter.emit("execution:started",this.createContext(e,t)),!0),onFinished:(e,t)=>("scheduled"===t.reason&&this.changeState("idle"),this.emitter.emit("execution:finished",this.createContext(e,t)),!0),onError:(e,t,r)=>{u.default.error(t),this.emitter.emit("execution:failed",this.createContext(e,r)),this.changeState("idle")},onOverlap:e=>{this.emitter.emit("execution:overlap",this.createContext(e))},onMissedExecution:e=>{this.emitter.emit("execution:missed",this.createContext(e))},onMaxExecutions:e=>{this.emitter.emit("execution:maxReached",this.createContext(e)),this.destroy()}};this.runner=new n.Runner(this.timeMatcher,(e,r)=>t(this.createContext(e,r)),s)}getNextRun(){return"stopped"!==this.stateMachine.state?this.runner.nextRun():null}changeState(e){this.runner.isStarted()&&this.stateMachine.changeState(e)}start(){this.runner.isStopped()&&(this.runner.start(),this.stateMachine.changeState("idle"),this.emitter.emit("task:started",this.createContext(new Date)))}stop(){this.runner.isStarted()&&(this.runner.stop(),this.stateMachine.changeState("stopped"),this.emitter.emit("task:stopped",this.createContext(new Date)))}getStatus(){return this.stateMachine.state}destroy(){"destroyed"!==this.stateMachine.state&&(this.stop(),this.stateMachine.changeState("destroyed"),this.emitter.emit("task:destroyed",this.createContext(new Date)))}execute(){return new Promise((e,t)=>{let r=e=>{this.off("execution:finished",r),t(e.execution?.error)};this.once("execution:finished",t=>{this.off("execution:failed",r),e(t.execution?.result)}),this.once("execution:failed",r),this.runner.execute()})}on(e,t){this.emitter.on(e,t)}off(e,t){this.emitter.off(e,t)}once(e,t){this.emitter.once(e,t)}createContext(e,t){let r=new h.LocalizedTime(e,this.timezone),s={date:r.toDate(),dateLocalIso:r.toISO(),triggeredAt:new Date,task:this,execution:t};return s}}t.InlineScheduledTask=d},958:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.StateMachine=void 0;let r={stopped:["stopped","idle","destroyed"],idle:["idle","running","stopped","destroyed"],running:["running","idle","stopped","destroyed"],destroyed:["destroyed"]};class s{constructor(e="stopped"){this.state=e}changeState(e){if(r[this.state].includes(e))this.state=e;else throw Error(`invalid transition from ${this.state} to ${e}`)}}t.StateMachine=s},8279:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.LocalizedTime=void 0;class r{constructor(e,t){this.timestamp=e.getTime(),this.timezone=t,this.parts=s(e,t)}toDate(){return new Date(this.timestamp)}toISO(){let e=this.parts.gmt.replace(/^GMT/,""),t=e=>String(e).padStart(2,"0");return`${this.parts.year}-${t(this.parts.month)}-${t(this.parts.day)}T${t(this.parts.hour)}:${t(this.parts.minute)}:${t(this.parts.second)}.${String(this.parts.milisecond).padStart(3,"0")}`+(e||"Z")}getParts(){return this.parts}set(e,t){this.parts[e]=t;let r=new Date(this.toISO());this.timestamp=r.getTime(),this.parts=s(r,this.timezone)}}function s(e,t){let r={year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit",second:"2-digit",weekday:"short",hour12:!1};t&&(r.timeZone=t);let s=new Intl.DateTimeFormat("en-US",r),i=s.formatToParts(e).filter(e=>"literal"!==e.type).reduce((e,t)=>(e[t.type]=t.value,e),{});return{day:parseInt(i.day),month:parseInt(i.month),year:parseInt(i.year),hour:"24"===i.hour?0:parseInt(i.hour),minute:parseInt(i.minute),second:parseInt(i.second),milisecond:e.getMilliseconds(),weekday:i.weekday,gmt:function(e,t){let r=new Date(e.toLocaleString("en-US",{timeZone:"UTC"})),s=new Date(e.toLocaleString("en-US",{timeZone:t})),i=(r.getTime()-s.getTime())/6e4,n=i<=0?"+":"-";if(0===(i=Math.abs(i)))return"Z";let o=Math.floor(i/60).toString().padStart(2,"0"),a=Math.floor(i%60).toString().padStart(2,"0");return`GMT${n}${o}:${a}`}(e,t)}}t.LocalizedTime=r},8630:(e,t,r)=>{var s=function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.MatcherWalker=void 0;let i=s(r(4117)),n=r(8279),o=r(4629),a=s(r(6256));class c{constructor(e,t,r){this.cronExpression=e,this.baseDate=t,this.timeMatcher=new o.TimeMatcher(e,r),this.timezone=r,this.expressions=(0,i.default)(e)}isMatching(){return this.timeMatcher.match(this.baseDate)}matchNext(){let e=(()=>{let e=new Date(this.baseDate.getTime());e.setMilliseconds(0);let t=new n.LocalizedTime(e,this.timezone),r=t.getParts(),s=new n.LocalizedTime(t.toDate(),this.timezone),i=this.expressions[0],o=u(i,r.second);if(o&&(s.set("second",o),this.timeMatcher.match(s.toDate())))return s;s.set("second",i[0]);let a=this.expressions[1],c=u(a,r.minute);if(c&&(s.set("minute",c),this.timeMatcher.match(s.toDate())))return s;s.set("minute",a[0]);let h=this.expressions[2],l=u(h,r.hour);if(l&&(s.set("hour",l),this.timeMatcher.match(s.toDate())))return s;s.set("hour",h[0]);let d=this.expressions[3],f=u(d,r.day);if(f&&(s.set("day",f),this.timeMatcher.match(s.toDate())))return s;s.set("day",d[0]);let m=this.expressions[4],p=u(m,r.month);return p&&(s.set("month",p),this.timeMatcher.match(s.toDate()))||(s.set("year",s.getParts().year+1),s.set("month",m[0])),s})(),t=this.expressions[5],r=parseInt((0,a.default)(e.getParts().weekday));for(;!(t.indexOf(r)>-1);)e.set("year",e.getParts().year+1),r=parseInt((0,a.default)(e.getParts().weekday));return e}}function u(e,t){let r=e.sort((e,t)=>e-t).filter(e=>e>t);return r.length>0&&r[0]}t.MatcherWalker=c},4629:(e,t,r)=>{var s=function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.TimeMatcher=void 0;let i=s(r(4117)),n=s(r(6256)),o=r(8279),a=r(8630);function c(e,t){return -1!==e.indexOf(t)}class u{constructor(e,t){this.timezone=t,this.pattern=e,this.expressions=(0,i.default)(e)}match(e){let t=new o.LocalizedTime(e,this.timezone),r=t.getParts(),s=c(this.expressions[0],r.second),i=c(this.expressions[1],r.minute),a=c(this.expressions[2],r.hour),u=c(this.expressions[3],r.day),h=c(this.expressions[4],r.month),l=c(this.expressions[5],parseInt((0,n.default)(r.weekday)));return s&&i&&a&&u&&h&&l}getNextMatch(e){let t=new a.MatcherWalker(this.pattern,e,this.timezone),r=t.matchNext();return r.toDate()}}t.TimeMatcher=u}};var t=require("../../../webpack-runtime.js");t.C(e);var r=e=>t(t.s=e),s=t.X(0,[271,107],()=>r(5493));module.exports=s})();